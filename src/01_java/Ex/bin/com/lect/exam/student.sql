-- DROP
DROP TABLE STUDENT;
DROP TABLE MAJOR;
DROP SEQUENCE STUDENT_SQ;

-- CREATE TABLE

CREATE TABLE MAJOR(
    MNO NUMBER(4) PRIMARY KEY,
    MNAME VARCHAR2(40)
);


INSERT INTO MAJOR VALUES(1,'빅데이터학');
INSERT INTO MAJOR VALUES(2,'경영정보학');
INSERT INTO MAJOR VALUES(3,'컴퓨터공학');
INSERT INTO MAJOR VALUES(4,'디지털공학');
INSERT INTO MAJOR VALUES(5,'인공지능학');

CREATE TABLE STUDENT(
    SNO VARCHAR2(8) PRIMARY KEY,
    SNAME VARCHAR2(30),
    MNO NUMBER(4),
    SCORE NUMBER(3),
    SEXPEL NUMBER(1) DEFAULT 0 CHECK(SEXPEL = 0 OR SEXPEL = 1),
    FOREIGN KEY(MNO) REFERENCES MAJOR(MNO)
    
);
INSERT INTO STUDENT (sNO, sNAME, mNO, SCORE) VALUES
(TO_CHAR(SYSDATE, 'YYYY')
||TRIM(TO_CHAR(STUDENT_SQ.NEXTVAL,'000')),
'컴길동',(SELECT mNO FROM MAJOR WHERE mNAME='컴퓨터공학'), 67);

INSERT INTO STUDENT (sNO, sNAME, mNO, SCORE) VALUES
(TO_CHAR(SYSDATE, 'YYYY')
||TRIM(TO_CHAR(STUDENT_SQ.NEXTVAL,'000')),
'홍길동',(SELECT mNO FROM MAJOR WHERE mNAME='빅데이터학'), 90);

INSERT INTO STUDENT (sNO, sNAME, mNO, SCORE) VALUES
(TO_CHAR(SYSDATE, 'YYYY')
||TRIM(TO_CHAR(STUDENT_SQ.NEXTVAL,'000')),
'경길동',(SELECT mNO FROM MAJOR WHERE mNAME='경영정보학'), 80);

INSERT INTO STUDENT (sNO, sNAME, mNO, SCORE) VALUES
(TO_CHAR(SYSDATE, 'YYYY')
||TRIM(TO_CHAR(STUDENT_SQ.NEXTVAL,'000')),
'디길동',(SELECT mNO FROM MAJOR WHERE mNAME='디지털공학'), 40);

INSERT INTO STUDENT (sNO, sNAME, mNO, SCORE) VALUES
(TO_CHAR(SYSDATE, 'YYYY')
||TRIM(TO_CHAR(STUDENT_SQ.NEXTVAL,'000')),
'인길동',(SELECT mNO FROM MAJOR WHERE mNAME='인공지능학'), 58);
SELECT *
    FROM STUDENT;


CREATE SEQUENCE STUDENT_SQ
    MAXVALUE 99999999
    NOCYCLE
    NOCACHE;
    
SELECT EXTRACT(YEAR FROM SYSDATE) || TRIM(TO_CHAR(STUDENT_SQ.CURRVAL,'000')) SNO FROM DUAL;
    -- INSERT
    

    
    
SELECT *
    FROM STUDENT
    WHERE SNO LIKE ('%' || '001');
SELECT *
    FROM STUDENT;
SELECT *
    FROM MAJOR;
    
SELECT *
    FROM STUDENT
    WHERE SNAME = '신길동';
    
    
SELECT *
    FROM MAJOR
    WHERE MNAME = '빅데이터학';

INSERT INTO STUDENT (sNO, sNAME, mNO, SCORE) VALUES
(TO_CHAR(SYSDATE, 'YYYY')
||TRIM(TO_CHAR(STUDENT_SQ.NEXTVAL,'000')),
'디길동',(SELECT mNO FROM MAJOR WHERE mNAME='디지털공학'), 100);

--SELECT ROWNUM, RN, ENAME, SAL
--    FROM (SELECT ROWNUM RN, ENAME, SAL
--            FROM (SELECT ENAME, SAL
--                        FROM EMP
--                        ORDER BY SAL)
--            ORDER BY SAL);    
SELECT SNAME||'('||SNO||')' NAME, MNAME||'('||M.MNO||')' MNAME, SCORE
    FROM STUDENT S, MAJOR M
    WHERE S.MNO=M.MNO
    ORDER BY SCORE DESC;

SELECT ROWNUM RANK, A.*
    FROM (SELECT SNAME||'('||SNO||')' NAME, MNAME||'('||M.MNO||')' MNAME, SCORE
        FROM STUDENT S, MAJOR M
        WHERE S.MNO=M.MNO and mname='빅데이터학'
        ORDER BY SCORE DESC) A ;
        
SELECT ROWNUM RANK, A.*
    FROM (SELECT SNAME||'('||SNO||')' NAME, MNAME||'('||M.MNO||')' MNAME, SCORE
        FROM STUDENT S, MAJOR M
        WHERE S.MNO=M.MNO and SEXPEL = 0
        ORDER BY SCORE DESC) A ;


SELECT *
    FROM STUDENT;

UPDATE STUDENT
    SET SNAME = '육길동', MNO = '4', SCORE = '77', SEXPEL = 0
    WHERE SNO = '2021001';
        
 UPDATE STUDENT
    SET SEXPEL = 1
    WHERE SNO = '2021001';


SELECT MNAME
    FROM MAJOR;

SELECT S.*, MNAME
    FROM STUDENT S, MAJOR M
    WHERE S.MNO = M.MNO
    ;
 
 SELECT SNAME||'('||SNO||')' NAME, MNAME||'('||M.MNO||')' MNAME, SCORE
    FROM STUDENT S, MAJOR M
    WHERE S.MNO=M.MNO AND SEXPEL = 0
    ORDER BY SCORE DESC;
    
SELECT ROWNUM RANK, A.*
    FROM (SELECT SNAME||'('||SNO||')' NAME, MNAME||'('||M.MNO||')' MNAME, SCORE
        FROM STUDENT S, MAJOR M
        WHERE S.MNO=M.MNO AND SEXPEL = 1
        ORDER BY SCORE DESC) A ;

commit;

